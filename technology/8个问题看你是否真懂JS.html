<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS的8个问题 | KuoJay Blog</title>
    <meta name="description" content="">
    <link rel="icon" href="/img/logo.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.ee3431e8.css" as="style"><link rel="preload" href="/assets/js/app.e45c2cda.js" as="script"><link rel="preload" href="/assets/js/16.d2fb062f.js" as="script"><link rel="prefetch" href="/assets/js/10.e8a644bc.js"><link rel="prefetch" href="/assets/js/11.f60f17d6.js"><link rel="prefetch" href="/assets/js/12.192d71d3.js"><link rel="prefetch" href="/assets/js/13.25830df2.js"><link rel="prefetch" href="/assets/js/14.1c3c2237.js"><link rel="prefetch" href="/assets/js/15.a3c4e20a.js"><link rel="prefetch" href="/assets/js/17.4a6f1f2e.js"><link rel="prefetch" href="/assets/js/18.3dc22d52.js"><link rel="prefetch" href="/assets/js/19.33a0794e.js"><link rel="prefetch" href="/assets/js/2.28c6f05c.js"><link rel="prefetch" href="/assets/js/20.273b3d3f.js"><link rel="prefetch" href="/assets/js/21.5d275d6b.js"><link rel="prefetch" href="/assets/js/22.abf29d4a.js"><link rel="prefetch" href="/assets/js/23.e42ab9ec.js"><link rel="prefetch" href="/assets/js/24.6ebbb4ab.js"><link rel="prefetch" href="/assets/js/25.6aef6983.js"><link rel="prefetch" href="/assets/js/26.a932061a.js"><link rel="prefetch" href="/assets/js/27.ca61a882.js"><link rel="prefetch" href="/assets/js/28.0a812e81.js"><link rel="prefetch" href="/assets/js/29.b40d3df2.js"><link rel="prefetch" href="/assets/js/3.a09ff4a2.js"><link rel="prefetch" href="/assets/js/30.a157bcd6.js"><link rel="prefetch" href="/assets/js/31.1d3fb68f.js"><link rel="prefetch" href="/assets/js/32.bc2fd972.js"><link rel="prefetch" href="/assets/js/33.643b309e.js"><link rel="prefetch" href="/assets/js/34.0983f214.js"><link rel="prefetch" href="/assets/js/35.149986d5.js"><link rel="prefetch" href="/assets/js/36.788a3e7d.js"><link rel="prefetch" href="/assets/js/37.8c07f284.js"><link rel="prefetch" href="/assets/js/38.2866e17a.js"><link rel="prefetch" href="/assets/js/39.6d964a23.js"><link rel="prefetch" href="/assets/js/4.4bf77ba4.js"><link rel="prefetch" href="/assets/js/40.f4e1e42a.js"><link rel="prefetch" href="/assets/js/41.5d8f53cc.js"><link rel="prefetch" href="/assets/js/42.7686a08e.js"><link rel="prefetch" href="/assets/js/43.5d0f258a.js"><link rel="prefetch" href="/assets/js/44.8fbfd791.js"><link rel="prefetch" href="/assets/js/45.569e0950.js"><link rel="prefetch" href="/assets/js/46.8e344c69.js"><link rel="prefetch" href="/assets/js/47.153ab7de.js"><link rel="prefetch" href="/assets/js/48.fd6aca86.js"><link rel="prefetch" href="/assets/js/49.80e1ab43.js"><link rel="prefetch" href="/assets/js/5.6641b486.js"><link rel="prefetch" href="/assets/js/50.fc72a81a.js"><link rel="prefetch" href="/assets/js/51.33dd9604.js"><link rel="prefetch" href="/assets/js/52.7fd01621.js"><link rel="prefetch" href="/assets/js/53.33353c97.js"><link rel="prefetch" href="/assets/js/54.9fa2e3a3.js"><link rel="prefetch" href="/assets/js/55.62a1bda1.js"><link rel="prefetch" href="/assets/js/56.f9b94f2a.js"><link rel="prefetch" href="/assets/js/57.b4fb1f3d.js"><link rel="prefetch" href="/assets/js/58.338b49e8.js"><link rel="prefetch" href="/assets/js/59.ef3b5b73.js"><link rel="prefetch" href="/assets/js/6.f968c14b.js"><link rel="prefetch" href="/assets/js/60.3fdbde82.js"><link rel="prefetch" href="/assets/js/61.71670501.js"><link rel="prefetch" href="/assets/js/62.8085fc99.js"><link rel="prefetch" href="/assets/js/63.06451bdf.js"><link rel="prefetch" href="/assets/js/64.b5c56fb1.js"><link rel="prefetch" href="/assets/js/65.7245b999.js"><link rel="prefetch" href="/assets/js/66.0fb2160f.js"><link rel="prefetch" href="/assets/js/67.7f3720af.js"><link rel="prefetch" href="/assets/js/68.b4e6df2b.js"><link rel="prefetch" href="/assets/js/69.c17e5a4d.js"><link rel="prefetch" href="/assets/js/7.9fb8d288.js"><link rel="prefetch" href="/assets/js/70.d01e45e2.js"><link rel="prefetch" href="/assets/js/71.59b20ff0.js"><link rel="prefetch" href="/assets/js/72.8755c342.js"><link rel="prefetch" href="/assets/js/73.1dbfddc4.js"><link rel="prefetch" href="/assets/js/74.b9d5f5e5.js"><link rel="prefetch" href="/assets/js/75.b3d00a1c.js"><link rel="prefetch" href="/assets/js/76.a314d24f.js"><link rel="prefetch" href="/assets/js/77.cd1d7149.js"><link rel="prefetch" href="/assets/js/78.9d37d951.js"><link rel="prefetch" href="/assets/js/79.bf5bdc05.js"><link rel="prefetch" href="/assets/js/8.444fccc9.js"><link rel="prefetch" href="/assets/js/80.3f0be298.js"><link rel="prefetch" href="/assets/js/81.617c7c41.js"><link rel="prefetch" href="/assets/js/82.61e9e0b4.js"><link rel="prefetch" href="/assets/js/83.a26764f0.js"><link rel="prefetch" href="/assets/js/84.db5e3248.js"><link rel="prefetch" href="/assets/js/85.83ac40b8.js"><link rel="prefetch" href="/assets/js/86.c0af6c1f.js"><link rel="prefetch" href="/assets/js/9.f4eb60f8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ee3431e8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="KuoJay Blog" class="logo"> <span class="site-name can-hide">KuoJay Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">笔记</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">笔记</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>JS的8个问题</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#js的8个问题" class="sidebar-link">JS的8个问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_1-浏览器控制台上会打印什么？" class="sidebar-link">1. 浏览器控制台上会打印什么？</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_2-如果我们使用-let-或-const-代替-var，输出是否相同" class="sidebar-link">2. 如果我们使用 let 或 const 代替 var，输出是否相同</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_3-“newarray”中有哪些元素？" class="sidebar-link">3. “newArray”中有哪些元素？</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_4-如果我们在浏览器控制台中运行-foo-函数，是否会导致堆栈溢出错误？" class="sidebar-link">4. 如果我们在浏览器控制台中运行'foo'函数，是否会导致堆栈溢出错误？</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_6-我们能否以某种方式为下面的语句使用展开运算而不导致类型错误" class="sidebar-link">6. 我们能否以某种方式为下面的语句使用展开运算而不导致类型错误</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_7-运行以下代码片段时，控制台上会打印什么？" class="sidebar-link">7. 运行以下代码片段时，控制台上会打印什么？</a></li><li class="sidebar-sub-header"><a href="/technology/8%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9C%8B%E4%BD%A0%E6%98%AF%E5%90%A6%E7%9C%9F%E6%87%82JS.html#_8-xgetter-会打印什么值？" class="sidebar-link">8. xGetter() 会打印什么值？</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="js的8个问题"><a href="#js的8个问题" class="header-anchor">#</a> JS的8个问题</h2> <p><a href="https://juejin.im/post/6844903890270289928" target="_blank" rel="noopener noreferrer">原文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_1-浏览器控制台上会打印什么？"><a href="#_1-浏览器控制台上会打印什么？" class="header-anchor">#</a> 1. 浏览器控制台上会打印什么？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ??</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出<code>undefined</code></p> <p>使用<code>var</code>关键字声明的变量在<code>JavaScript</code>中会被提升，并在内存中分配值<code>undefined</code>。 但初始化恰发生在你给变量赋值的地方。 另外，var声明的变量是函数作用域的，而<code>let</code>和<code>const</code>是块作用域的。 所以，这就是这个过程的样子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 全局使用域</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// var a 的声明将被提升到到函数的顶部。</span>
<span class="token comment">// 比如:var a</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 undefined</span>

<span class="token comment">// 实际初始化值20只发生在这里</span>
   <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// local scope</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-如果我们使用-let-或-const-代替-var，输出是否相同"><a href="#_2-如果我们使用-let-或-const-代替-var，输出是否相同" class="header-anchor">#</a> 2. 如果我们使用 <code>let</code> 或 <code>const</code> 代替 <code>var</code>，输出是否相同</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ??</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>输出一个错误<code>ReferenceError：a undefined</code> <code>let</code>和<code>const</code>声明可以让变量在其作用域上受限于它所使用的块、语句或表达式。与<code>var</code>不同的是，这些变量没有被提升，并且有一个所谓的暂时死区(TDZ)。试图访问TDZ中的这些变量将引发<code>ReferenceError</code>，因为只有在执行到达声明时才能访问它们。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 全局使用域</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// TDZ 开始</span>

<span class="token comment">// 创建了未初始化的'a'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>

<span class="token comment">// TDZ结束，'a'仅在此处初始化，值为20</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下表概述了与JavaScript中使用的不同关键字声明的变量对应的提升行为和使用域：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/7/16/16bf818411c576e9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p> <h3 id="_3-“newarray”中有哪些元素？"><a href="#_3-“newarray”中有哪些元素？" class="header-anchor">#</a> 3. “newArray”中有哪些元素？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> newArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ??   </span>
</code></pre></div><p>输出<code>[3, 3, 3]</code></p> <p>在<code>for</code>循环的头部声明带有<code>var</code>关键字的变量会为该变量创建单个绑定（存储空间）。 阅读更多关于闭包的信息。 让我们再看一次<code>for</code>循环。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 误解作用域:认为存在块级作用域</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 三个箭头函数体中的每个`'i'`都指向相同的绑定，</span>
  <span class="token comment">// 这就是为什么它们在循环结束时返回相同的值'3'。</span>
  array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> newArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3, 3, 3]</span>
</code></pre></div><p>如果使用 <code>let</code> 声明一个具有块级作用域的变量，则为每个循环迭代创建一个新的绑定。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用ES6块级作用域</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这一次，每个'i'指的是一个新的的绑定，并保留当前的值。</span>
 <span class="token comment">// 因此，每个箭头函数返回一个不同的值。</span>
  array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> newArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [0, 1, 2]</span>
</code></pre></div><p>解决这个问题的另一种方法是使用闭包。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> newArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token function">el</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [0, 1, 2]  </span>
</code></pre></div><h3 id="_4-如果我们在浏览器控制台中运行-foo-函数，是否会导致堆栈溢出错误？"><a href="#_4-如果我们在浏览器控制台中运行-foo-函数，是否会导致堆栈溢出错误？" class="header-anchor">#</a> 4. 如果我们在浏览器控制台中运行'foo'函数，是否会导致堆栈溢出错误？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否存在堆栈溢出错误?</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>    
</code></pre></div><p>JavaScript并发模型基于“事件循环”。 当我们说“浏览器是 JS 的家”时我真正的意思是浏览器提供运行时环境来执行我们的JS代码。
浏览器的主要组件包括调用堆栈，事件循环**，任务队列和Web API**。 像setTimeout，setInterval和Promise这样的全局函数不是JavaScript的一部分，而是 Web API 的一部分。 JavaScript 环境的可视化形式如下所示：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/7/16/16bf818729833534?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p> <p>JS调用栈是后进先出(LIFO)的。引擎每次从堆栈中取出一个函数，然后从上到下依次运行代码。每当它遇到一些异步代码，如setTimeout，它就把它交给Web API(箭头1)。因此，每当事件被触发时，callback 都会被发送到任务队列（箭头2）。</p> <p><strong>事件循环(Event loop)不断地监视任务队列(Task Queue)，并按它们排队的顺序一次处理一个回调。每当调用堆栈(call stack)为空时，Event loop获取回调并将其放入堆栈(stack )</strong>(箭头3)中进行处理。请记住，如果调用堆栈不是空的，<strong>则事件循环不会将任何回调推入堆栈</strong>。
现在，有了这些知识，让我们来回答前面提到的问题：</p> <h4 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h4> <hr> <ol><li><p>调用 foo()会将foo函数放入调用堆栈(call stack)。</p></li> <li><p>在处理内部代码时，JS引擎遇到setTimeout。</p></li> <li><p>然后将foo回调函数传递给WebAPIs(箭头1)并从函数返回，调用堆栈再次为空</p></li> <li><p>计时器被设置为0，因此foo将被发送到任务队列(箭头2)。</p></li> <li><p>由于调用堆栈是空的，事件循环将选择foo回调并将其推入调用堆栈进行处理。</p></li> <li><p>进程再次重复，堆栈不会溢出。</p></li></ol> <p>运行示意图如下所示：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/7/16/16bf81900b5a9abf?imageslim" alt="image"></p> <hr> <h4 id="_5-如果在控制台中运行以下函数，页面-选项卡-的-ui-是否仍然响应"><a href="#_5-如果在控制台中运行以下函数，页面-选项卡-的-ui-是否仍然响应" class="header-anchor">#</a> 5. 如果在控制台中运行以下函数，页面(选项卡)的 UI 是否仍然响应</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>    
</code></pre></div><p>不会响应</p> <p>大多数时候，开发人员假设在<strong>事件循环图中只有一个任务队列。但事实并非如此，我们可以有多个任务队列。由浏览器选择其中的一个队列并在该队列中处理回调。</strong>
在底层来看，JavaScript中有宏任务和微任务。<code>setTimeout</code>回调是<strong>宏任务</strong>，而<code>Promise</code>回调是<strong>微任务</strong>。
主要的区别在于他们的执行方式。宏任务在单个循环周期中一次一个地推入堆栈，但是微任务队列总是在执行后返回到事件循环之前清空。因此，如果你以处理条目的速度向这个队列添加条目，那么你就永远在处理微任务。只有当微任务队列为空时，事件循环才会重新渲染页面、
现在，当你在控制台中运行以下代码段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>每次调用'foo'都会继续在微任务队列上添加另一个'foo'回调，因此事件循环无法继续处理其他事件（滚动，单击等），直到该队列完全清空为止。 因此，它会阻止渲染。</p> <h3 id="_6-我们能否以某种方式为下面的语句使用展开运算而不导致类型错误"><a href="#_6-我们能否以某种方式为下面的语句使用展开运算而不导致类型错误" class="header-anchor">#</a> 6. 我们能否以某种方式为下面的语句使用展开运算而不导致类型错误</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">...</span>obj<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// TypeError </span>
</code></pre></div><p><strong>会导致TypeError错误</strong></p> <p><strong>展开语法</strong> 和 <strong>for-of</strong> 语句遍历<code>iterable</code>对象定义要遍历的数据。<code>Array</code> 或<code>Map</code> 是具有默认迭代行为的内置迭代器。对象不是可迭代的，但是可以通过使用<strong>iterable</strong>和<strong>iterator</strong>协议使它们可迭代。
在<strong>Mozilla</strong>文档中，如果一个对象实现了<code>@@iterator</code>方法，那么它就是可迭代的，这意味着这个对象(或者它原型链上的一个对象)必须有一个带有<code>@@iterator</code>键的属性，这个键可以通过常量<code>Symbol.iterator</code>获得。</p> <p>上述语句可能看起来有点冗长，但是下面的示例将更有意义：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// iterator 是一个具有 next 方法的对象，</span>
  <span class="token comment">// 它的返回至少有一个对象</span>
  <span class="token comment">// 两个属性：value＆done。</span>

  <span class="token comment">// 返回一个 iterator 对象</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_countDown <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> lastValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_countDown<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_countDown<span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_countDown <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_countDown <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_countDown<span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    _countDown<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">...</span>obj<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 打印 [1, 2, 3]</span>
</code></pre></div><p>还可以使用 generator 函数来定制对象的迭代行为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token operator">...</span>obj<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 打印 [1, 2, 3]</span>
</code></pre></div><h3 id="_7-运行以下代码片段时，控制台上会打印什么？"><a href="#_7-运行以下代码片段时，控制台上会打印什么？" class="header-anchor">#</a> 7. 运行以下代码片段时，控制台上会打印什么？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> enumerable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// what properties will be printed when we run the for-in loop?</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre></div><p><strong>a, b, c</strong></p> <p><code>for-in</code>循环遍历对象本身的可枚举属性以及对象从其原型继承的属性。 可枚举属性是可以在<code>for-in</code>循环期间包含和访问的属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>enumerable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: 1, writable: true, enumerable: true, configurable: true }</span>
</code></pre></div><p>现在你已经掌握了这些知识，应该很容易理解为什么我们的代码要打印这些特定的属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//a，b 都是 enumerables 属性</span>

<span class="token comment">// 将{c：3}设置为'obj'的原型，并且我们知道</span>
<span class="token comment">// for-in 循环也迭代 obj 继承的属性</span>
<span class="token comment">// 从它的原型，'c'也可以被访问。</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 我们在'obj'中定义了另外一个属性'd'，但是 </span>
<span class="token comment">// 将'enumerable'设置为false。 这意味着'd'将被忽略。</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> enumerable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>
<span class="token comment">// c</span>
</code></pre></div><h3 id="_8-xgetter-会打印什么值？"><a href="#_8-xgetter-会打印什么值？" class="header-anchor">#</a> 8. xGetter() 会打印什么值？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getX</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints 90</span>
<span class="token keyword">var</span> xGetter <span class="token operator">=</span> foo<span class="token punctuation">.</span>getX<span class="token punctuation">;</span>
<span class="token function">xGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints ??</span>
</code></pre></div><p><strong>10</strong></p> <p>在全局范围内初始化x时，它成为window对象的属性(不是严格的模式)。看看下面的代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// global scope</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getX</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints 90</span>
<span class="token keyword">let</span> xGetter <span class="token operator">=</span> foo<span class="token punctuation">.</span>getX<span class="token punctuation">;</span>
<span class="token function">xGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints 10</span>
</code></pre></div><p>咱们可以断言：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>x <span class="token operator">===</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p><code>this</code> 始终指向调用方法的对象。因此，在<code>foo.getx()</code>的例子中，它指向<code>foo</code>对象，返回<code>90</code>的值。而在<code>xGetter()</code>的情况下，<code>this</code>指向 <code>window</code>对象, 返回 <code>window</code> 中的x的值，即<code>10</code>。
要获取 <code>foo.x</code>的值，可以通过使用<code>Function.prototype.bind</code>将<code>this</code>的值绑定到<code>foo</code>对象来创建新函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> getFooX <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getFooX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 90</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.e45c2cda.js" defer></script><script src="/assets/js/16.d2fb062f.js" defer></script>
  </body>
</html>
